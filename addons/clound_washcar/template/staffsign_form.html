{template 'common/header'}
{template 'resource'}
<div class="main">
	<ul class="nav nav-tabs">
		<li><a href="{php echo $this->createWebUrl('sign',array('op'=>'list'));}">签到管理</a></li>		<li class="active"><a href="{php echo $this->createWebUrl('sign',array('op'=>'edit'));}">添加员工签到</a></li>
	</ul>		<form action="" class="form-horizontal form" method="post" enctype="multipart/form-data" onsubmit="return formcheck()">		<input type="hidden" name="id" value="{$item[$mainid]['id']}">		<div class="panel panel-default">			<div class="panel-heading">				会员基本信息			</div>									<div class="panel-body">							<div class="form-group">					<label class="col-xs-12 col-sm-3 col-md-2 control-label">员工ID</label>					<div class="col-sm-9 col-xs-12">						<input type="text" id="staffid" name="staffid"  class="form-control" value="{$staffitem['id']}" readonly="readonly" >					</div>				</div>								<div class="form-group">					<label class="col-xs-12 col-sm-3 col-md-2 control-label">姓名</label>					<div class="col-sm-9 col-xs-12">						<input type="text" name="name" id="name"  class="form-control" value="{$staffitem['name']}" readonly="readonly">					</div>				</div>								<div class="form-group">					<label class="col-xs-12 col-sm-3 col-md-2 control-label">手机号</label>					<div class="col-sm-9 col-xs-12">						<input type="text" name="phone" id="phone"  class="form-control" value="{$staffitem['telephone']}" readonly="readonly">					</div>				</div>								<div class="form-group">					<label class="col-xs-12 col-sm-3 col-md-2 control-label">时间范围</label>					<div class="col-sm-3 col-xs-12">												{php echo $this->tpl_form_field_daterange('date', array('starttime'=>$currentdate ,endtime=>$currentdate))}					</div>					<input type="hidden" id="totalday" name="totalday" value="1"/>					<span id="totaldaylabel" class='help-block'>共1天</span>				</div>			</div>		</div>		<div class="panel panel-default">		<div class="panel-body table-responsive">			<table class="table table-hover">				<thead class="navbar-inner">				<tr>					<th class='with-checkbox' style='width:30px;'>						<input id="test1" type="checkbox" class="check_all" />					</th>					<th style="width:30px;">序号</th>										<th style="width:50px;">日期</th>										<th style="width:100px;">店铺</th>					<th style="width:20px;">上午</th>					<th style="width:20px;">下午</th>					<th style="width:160px;">备注</th>				</tr>				</thead>				<tbody>								<tr class="trorig">					<td class="with-checkbox">						<input type="checkbox" name="check" value="{$row['id']}"></td>					<td><input type="text" id="id[{php echo $currentdate}]" name="id[{php echo $currentdate}]" readonly="readonly" value="{$item['id']}" size="3"></td>					<td>{php echo $currentdate}</td>										<td>						<select class='form-control' id="chain[{php echo $currentdate}]" name="chain[{php echo $currentdate}]">							<option value=''>--请选择分店--</option>							{loop $washchar_chains $key $value}								<option value ="{$value['id']}" {if $item['chainid'] == $value['id']}selected="selected"{/if}>{$value['name']}</option>							{/loop}						</select>					</td>										<td><input type="checkbox"  name="checkam[{php echo $currentdate}]" id="checkam[{php echo $currentdate}]" value="{$item['am']}" {if $item['am']==1}checked="checked"{/if}></td>					<td><input type="checkbox" name="checkpm[{php echo $currentdate}]" id="checkpm[{php echo $currentdate}]" value="{$item['pm']}" {if $item['pm']==1}checked="checked"{/if}></td>					<td><input type="text" name="mem[{php echo $currentdate}]" value="{php echo $item['memo']}" /></td>				</tr>								<tr id="insert">					<td colspan="7">						<!-- input type="button" class="btn btn-primary" name="deleteall" value="删除选择的" / -->					</td>				</tr>				</tbody>				<input name="token" type="hidden" value="{$_W['token']}" />			</table>		</div>	</div>		<div class="form-group col-sm-12">			<input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1" />			<input type="hidden" name="token" value="{$_W['token']}" />		</div>	</form></div><script type="text/javascript">	var indexnum=1;	function search_business() {		$("#module-menus").html("正在搜索....")		$.post('{php echo $this->createWebUrl('GetBusiness');}', {			keyword: $.trim($('#search-kwd').val())		}, function(dat){			$('#module-menus').html(dat);		});	}	function select_business(o) {		$("#businessid").val(o.id);		$("#hotelbusiness").val( o.title );		$(".close").click();	}	function deletepic(obj){		if (confirm("确认要删除？")) {			var $thisob=$(obj);			var $liobj=$thisob.parent();			var picurl=$liobj.children('input').val();			$.post('{php echo $this->createMobileUrl('ajaxdelete',array())}',{ pic:picurl},function(m){				if(m=='1') {					$liobj.remove();				} else {					alert("删除失败");				}			},"html");		}	}		Date.prototype.Format = function (fmt) { //author: meizz     var o = {        "M+": this.getMonth() + 1, //月份         "d+": this.getDate(), //日         "h+": this.getHours(), //小时         "m+": this.getMinutes(), //分         "s+": this.getSeconds(), //秒         "q+": Math.floor((this.getMonth() + 3) / 3), //季度         "S": this.getMilliseconds() //毫秒     };    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));    for (var k in o)    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));    return fmt;}		function formatcheckbox(m,start,end,count) {		var startstr=start;			startstr = start.replace(/-/g,"/");			var date = new Date(startstr );			var i=0;			var tmpdate=new Date();			for(i=0;i<count;i++) {				tmpdate.setTime(date.getTime()+i*(1000 * 60 * 60 * 24));				var html=					'<tr class="trorig">'+						'<td class="with-checkbox">'+							'<input type="checkbox" name="check" value=""></td>'+						'<td><input type="text" readonly="readonly" id="id['+tmpdate.Format("yyyy-MM-dd")+']" name="id['+tmpdate.Format("yyyy-MM-dd")+']" value="" size="3"></td>'+						'<td>'+tmpdate.Format("yyyy-MM-dd")+'</td>'+						'<td><select class="form-control" id="chain['+tmpdate.Format("yyyy-MM-dd")+']" name="chain['+tmpdate.Format("yyyy-MM-dd")+']">'+							'<option value="">--请选择分店--</option>'+							{loop $washchar_chains $key $value}								'<option value ="{$value['id']}" >{$value['name']}</option>'+							{/loop}						'</select></td>'+						'<td><input type="checkbox" name="checkam['+tmpdate.Format("yyyy-MM-dd")+']"  id="checkam['+tmpdate.Format("yyyy-MM-dd")+']" value="11"></td>'+						'<td><input type="checkbox" name="checkpm['+tmpdate.Format("yyyy-MM-dd")+']"  id="checkpm['+tmpdate.Format("yyyy-MM-dd")+']" value=""></td>'+						'<td><input type="text" id="mem['+tmpdate.Format("yyyy-MM-dd")+']" name="mem['+tmpdate.Format("yyyy-MM-dd")+']" value="" /></td>'+					'</tr>';					$("#insert").before(html);			}						for(i=0;i<m.length;i++) {				if(m[i].am==1) {					$("#checkam\\["+m[i].date+"\\]").prop("checked",true);				} else {					$("#checkam\\["+m[i].date+"\\]").prop("checked");				}				if(m[i].pm==1) {					$("#checkpm\\["+m[i].date+"\\]").prop("checked",true);				} else {					$("#checkpm\\["+m[i].date+"\\]").prop("checked");				}				var value=m[i].chainid;				$("#chain\\["+m[i].date+"\\]").attr("value",value);				$("#chain\\["+m[i].date+"\\]").val(value);				$("#chain\\["+m[i].date+"\\]").get(0).value= value;								$("#id\\["+m[i].date+"\\]").val(m[i].id);								$("#mem\\["+m[i].date+"\\]").val(m[i].mem);			}	}	function initcheckbox(count,start,end) {					//先删除之前的行			$(".trorig").remove();			$.get('{php echo $this->createWebUrl('sign',array('op'=>'ajaxquery'))}',{ staffid:{php echo $staffitem['id']},start:start,end:end},function(m){				//alert(m);				formatcheckbox(m,start,end,count);			},"json");							}		$("input[name='date[end]']").on("change",function() {		var start=new Date($("input[name='date[start]']").val());		var end=new Date($("input[name='date[end]']").val());		var days=(Math.abs(start.getTime()-end.getTime())/ (1000 * 60 * 60 * 24))+1;				$("#totaldaylabel").text("共"+days+"天");		$("#totalday").val(days);		initcheckbox(days, $("input[name='date[start]']").val(), $("input[name='date[end]']").val());	}	);		$('input[name=deleteall]').click(function() {				$("#checkam\\[2017-07-27\\]").prop("checked",true);		$("#test1").prop("checked",true);		alert("test");	});	function delete_item(id) {		$("#"+id).parent().parent().parent().remove();	}	function del_device(num) {		$("#add_device_" + num).remove();	}	function formcheck() {		if ($("#title").val().trim() == '') {			Tip.focus("title", "请填写酒店名称!", "right");			return false;		}		return true;	}</script>

{template 'common/footer'}
